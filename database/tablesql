-- °èÁ¤ »ý¼º(°ü¸®ÀÚ·Î ÁøÇà)
drop user kh11 cascade;
create user kh11 identified by kh11;
grant connect, resource to kh11;

-- kh11·Î ·Î±×ÀÎ ÈÄ ÁøÇà

-- attendance Å×ÀÌºí
drop table attendance;
create table attendance(
no number(10),
name varchar2(21),
phone char(13)
);

-- worldcup Å×ÀÌºí
drop table worldcup;
create table worldcup(
rank number(3),
name varchar2(39),
nation varchar2(15),
goal number(2)
);

INSERT INTO WORLDCUP(RANK, NAME, NATION, GOAL)
VALUES(1, 'À½¹ÙÆä', 'ÇÁ¶û½º', 8);
INSERT INTO WORLDCUP(RANK, NAME, NATION, GOAL)
VALUES(2, '¸®¿À³Ú ¸Þ½Ã', '¾Æ¸£ÇîÆ¼³ª', 7);
insert into worldcup(rank, name, nation, goal)
values(3, '¿Ã¸®ºñ¿¡ Áö·ç', 'ÇÁ¶û½º', 4);
insert into worldcup(rank, name, nation, goal)
values(4, 'ÈÇ¸®¾È ¾Ë¹Ù·¹½º', '¾Æ¸£ÇîÆ¼³ª', 4);
commit;

-- pocketmon Å×ÀÌºí
drop table pocketmon;
CREATE TABLE POCKETMON(
NO NUMBER,--¾È¾²¸é ÀÚµ¿À¸·Î 38ÀÚ¸®°¡ µÊ
NAME VARCHAR2(21),
TYPE VARCHAR2(9)
);
insert into pocketmon(no,name,type) values(1,'ÀÌ»óÇØ¾¾','Ç®');
insert into pocketmon(no,name,type) values(4,'ÆÄÀÌ¸®','ºÒ²É');
insert into pocketmon(no,name,type) values(7,'²¿ºÎ±â','¹°');
insert into pocketmon(no,name,type) values(25,'ÇÇÄ«Ãò','Àü±â');
commit;

-- medalist Å×ÀÌºí
DROP TABLE MEDALIST;
CREATE TABLE MEDALIST(
NAME VARCHAR2(21),
EVENT VARCHAR2(30),
TYPE CHAR(6),
GOLD NUMBER(2),
SILVER NUMBER(2),
BRONZE NUMBER(2)
);
insert into medalist(name,event,type,gold,silver,bronze)
values('ÁøÁ¾¿À','»ç°Ý','ÇÏ°è',4,2,0);
insert into medalist(name,event,type,gold,silver,bronze)
values('±è¼ö³ç','¾ç±Ã','ÇÏ°è',4,1,1);
insert into medalist(name,event,type,gold,silver,bronze)
values('ÀüÀÌ°æ','¼îÆ®Æ®·¢','µ¿°è',4,0,1);
commit;

-- plan Å×ÀÌºí
drop table plan;
create table plan(
telecom char(2) not null check(telecom in ('SK','KT','LG')),
name varchar2(60) not null unique,
price number not null check(price >= 0),
data number not null check(data >= 0),
call number not null check(call >= 0),
sms number not null check(sms >= 0)
);

insert into plan(telecom,name,price,data,call,sms)
values('SK', '5G ¾ðÅÃÆ® 52', 52000, 200, 1000, 2000);
commit;

-- menu Å×ÀÌºí
drop table menu;
create table menu(
name varchar2(30) not null unique,
type varchar2(9) not null check(type in ('À½·á','µðÀúÆ®')),
price number not null check(price >= 0),
event char(1) not null check(event in ('0','1'))
);
insert into menu(name, type, price, event)
values('¾Æ¸Þ¸®Ä«³ë', 'À½·á', 2500, '1');
insert into menu(name, type, price, event)
values('¸ðÄ«¶ó¶¼', 'À½·á', 3500, '0');
insert into menu(name, type, price, event)
values('Ä¡ÁîÄÉÀÌÅ©', 'µðÀúÆ®', 5000, '1');
insert into menu(name, type, price, event)
values('¸¶Ä«·Õ', 'µðÀúÆ®', 3000, '0');
commit;

-- mobile Å×ÀÌºí
drop table mobile;
create table mobile (
name varchar2(12) not null,
telecom char(2) not null check(telecom in ('SK','KT','LG')),
price number not null check(price >= 0),
month number(2) check(month in (24, 30, 36)),
unique(name, telecom)
);
insert into mobile(name,telecom,price,month) 
values('°¶·°½Ã22s', 'SK', 1800000, null);
insert into mobile(name,telecom,price,month) 
values('°¶·°½Ã22s', 'KT', 1750000, 24);
insert into mobile(name,telecom,price,month) 
values('¾ÆÀÌÆù14', 'LG', 2000000, 30);
insert into mobile(name,telecom,price,month) 
values('¾ÆÀÌÆù14', 'SK', 1990000, null);
commit;

-- item Å×ÀÌºí
drop table item;
create table item (
--´ëÇ¥Ç×¸ñ(not null+unique)
no number primary key,
name varchar2(60) not null check(regexp_like(name,'^[°¡-ÆR0-9]+$')),
type varchar2(15) not null,
price number not null check(price >= 0),
early char(1) not null check(early in ('0','1')),
event char(1) not null check(event in ('0','1'))
);
drop sequence item_seq;
create sequence item_seq;

insert into item(no,name,type,price,early,event)
values(item_seq.nextval,'ÂüÀÌ½½ÈÄ·¹½Ã','ÁÖ·ù',1200,'1','1');
insert into item(no,name,type,price,early,event)
values(item_seq.nextval,'Å¬¶ó¿ìµå¸ÆÁÖ','ÁÖ·ù',3000,'0','1');
insert into item(no,name,type,price,early,event)
values(item_seq.nextval,'¹Ù³ª³ªÅ±','°úÀÚ',1500,'0','1');
insert into item(no,name,type,price,early,event)
values(item_seq.nextval,'Çã´Ï¹öÅÍÄ¨','°úÀÚ',2000,'1','0');
commit;

-- subject Å×ÀÌºí
drop table subject;
drop sequence subject_seq;
create table subject (
no number primary key,
name varchar2(60) not null,
period number not null check(mod(period, 30) = 0),
price number not null check(price >= 0),
type varchar2(12) not null check(type in ('¿Â¶óÀÎ','¿ÀÇÁ¶óÀÎ','È¥ÇÕ'))
);
create sequence subject_seq;

insert into subject(no,name,period,price,type) 
values(subject_seq.nextval,'ÀÚ¹Ù ¸¶½ºÅÍ°úÁ¤', 90, 1000000, '¿Â¶óÀÎ');
insert into subject(no,name,period,price,type) 
values(subject_seq.nextval,'ÆÄÀÌ½ã ±âÃÊ', 60, 600000, '¿Â¶óÀÎ');
insert into subject(no,name,period,price,type) 
values(subject_seq.nextval,'À¥ °³¹ßÀÚ ´Ü±â¿Ï¼º', 120, 1200000, '¿ÀÇÁ¶óÀÎ');

commit;

-- product Å×ÀÌºí
drop table product;
create table product(
no number primary key,
name varchar2(30) not null,
type varchar2(15) check(type in ('°úÀÚ','¾ÆÀÌ½ºÅ©¸²','ÁÖ·ù','»çÅÁ')),
price number,
made date,
expire date
);

insert into product values(1, '½ºÅ©·ù¹Ù', '¾ÆÀÌ½ºÅ©¸²', 1200, '2020-05-01', '2020-10-01');
insert into product values(2, '¸¶ÀÌÂé', '»çÅÁ', 900, '2020-01-01', '2021-01-01');
insert into product values(3, 'ÃÊÄÚÆÄÀÌ', '°úÀÚ', 3000, '2020-01-01', '2021-01-01');
insert into product values(4, '¸Àµ¿»ê', '°úÀÚ', 2200, '2020-02-01', '2020-10-20');
insert into product values(5, 'ÂüÀÌ½½', 'ÁÖ·ù', 1000, '2020-01-05', '2020-04-05');
insert into product values(6, 'Ã³À½Ã³·³', 'ÁÖ·ù', 1000, '2020-03-15', '2020-08-15');
insert into product values(7, '¹Ù³ª³ªÅ±', '°úÀÚ', 1500, '2020-05-03', '2020-06-03');
insert into product values(8, 'ºü»ßÄÚ', '¾ÆÀÌ½ºÅ©¸²', 1000, '2019-12-01', '2020-06-01');
insert into product values(9, '¸àÅä½º', '»çÅÁ', 1200, '2020-03-20', '2020-12-31');
insert into product values(10, '¿À·¹¿À', '°úÀÚ', 2100, '2019-06-01', '2020-06-01');

commit;

-- student Å×ÀÌºí
drop table student;
drop sequence student_seq;
create table student(
no number primary key,
name varchar2(21) not null check(regexp_like(name, '^[°¡-ÆR]{2,7}$')),
korean number(3) not null check(korean between 0 and 100),
english number(3) not null check(english between 0 and 100),
math number(3) not null check(math between 0 and 100)
);
create sequence student_seq;

-- È¸¿ø(member) Å×ÀÌºí
drop table member;
create table member(
member_id varchar2(20) primary key,
member_pw varchar2(16) not null,
member_nick varchar2(30) not null unique,
member_tel char(11) not null,
member_email varchar2(100),
member_birth char(10) not null,
member_post varchar2(6),
member_basic_addr varchar2(300),
member_detail_addr varchar2(300),
member_level varchar2(12) default 'ÁØÈ¸¿ø' not null,
member_point number default 0 not null,
member_join date default sysdate not null,
member_login date,
check(regexp_like(member_id,'^[a-z0-9-_]{5,20}$')),
check(
    regexp_like(member_pw, '[A-Z]+')
    and
    regexp_like(member_pw, '[a-z]+')
    and
    regexp_like(member_pw, '[0-9]+')
    and
    regexp_like(member_pw, '[!@#$]+')
    and
    regexp_like(member_pw, '^[A-Za-z0-9!@#$]{8,16}$')
),
check(regexp_like(member_nick, '^[°¡-ÆR0-9]{2,10}$')),
check(instr(member_email, '@') > 0),
check(regexp_like(member_birth, '^(19[0-9]{2}|20[0-9]{2})-((02-(0[1-9]|[12][0-9]))|((0[469])|11)-(0[1-9]|[12][0-9]|30)|((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01])))$')),
check(regexp_like(member_post, '^[0-9]{5,6}$')),
check(member_level in ('ÁØÈ¸¿ø','ÀÏ¹ÝÈ¸¿ø','¿ì¼öÈ¸¿ø','°ü¸®ÀÚ')),
check(member_point >= 0)
);

insert into member(
    member_id, member_pw, member_nick,
    member_tel, member_email, member_birth,
    member_post, member_basic_addr, member_detail_addr,
    member_level, member_point, member_join, member_login
)
values(?, ?, ?, ?, ?, ?, ?, ?, ?, 'ÁØÈ¸¿ø', 0, sysdate, null);

insert into member(
    member_id, member_pw, member_nick,
    member_tel, member_email, member_birth,
    member_post, member_basic_addr, member_detail_addr
)
values(?, ?, ?, ?, ?, ?, ?, ?, ?);



-- °Ô½ÃÆÇ
drop table board;
drop sequence board_seq;
create table board(
board_no number primary key,
--È¸¿ø ID¸¦ ÂüÁ¶ÇÏµµ·Ï ¼³Á¤(¿Ü·¡Å°, Foreign key)
--1.Á¸ÀçÇÏÁö ¾Ê´Â È¸¿ø ID¸¦ Ãß°¡ÇÏÁö ¾Êµµ·Ï ¼³Á¤ÇÒ ¼ö ÀÖÀ½
-- ÄÃ·³¸í references Å×ÀÌºí(´ë»óÄÃ·³¸í)
--2.È¸¿ø Å»Åð ½Ã °Ô½Ã±ÛÀÇ Ã³¸® ¿©ºÎ¸¦ ¼³Á¤ÇÒ ¼ö ÀÖÀ½
-- on delete cascade·Î ÀÛ¼ºÇÏ¸é È¸¿ø Å»Åð ½Ã ¿¬°áµÈ ±ÛÀÌ ¸ðµÎ »èÁ¦
-- on delete set null·Î ÀÛ¼ºÇÏ¸é È¸¿ø Å»Åð ½Ã ¿¬°áµÈ ±ÛÀÇ ÀÛ¼ºÀÚ°¡ null·Î º¯°æµÊ
--board_writer varchar2(20) not null,
board_writer references member(member_id) on delete set null,
board_title varchar2(300) not null,
board_content varchar2(4000) not null,
board_time date default sysdate not null,
board_head char(6) check(board_head in ('Á¤º¸', 'À¯¸Ó', '°øÁö')),
board_read number default 0 not null check(board_read >= 0),
board_like number default 0 not null check(board_like >= 0),
board_reply number default 0 not null check(board_reply >= 0)
);
create sequence board_seq;

insert into board(
    board_no, board_writer, board_title, board_content, board_time, 
    board_head, board_read, board_like, board_reply
) values(board_seq.nextval, 'testuser1', 'Å×½ºÆ®1', 'Å×½ºÆ®1', sysdate, null, 0, 0, 0);
insert into board(
    board_no, board_writer, board_title, board_content, board_time, 
    board_head, board_read, board_like, board_reply
) values(board_seq.nextval, 'testuser1', 'Å×½ºÆ®2', 'Å×½ºÆ®2', sysdate, null, 0, 0, 0);
insert into board(
    board_no, board_writer, board_title, board_content, board_time, 
    board_head, board_read, board_like, board_reply
) values(board_seq.nextval, 'testuser1', 'Å×½ºÆ®3', 'Å×½ºÆ®3', sysdate, null, 0, 0, 0);
insert into board(
    board_no, board_writer, board_title, board_content, board_time, 
    board_head, board_read, board_like, board_reply
) values(board_seq.nextval, 'testuser1', 'Å×½ºÆ®4', 'Å×½ºÆ®4', sysdate, null, 0, 0, 0);
insert into board(
    board_no, board_writer, board_title, board_content, board_time, 
    board_head, board_read, board_like, board_reply
) values(board_seq.nextval, 'testuser1', 'Å×½ºÆ®5', 'Å×½ºÆ®5', sysdate, null, 0, 0, 0);
insert into board(
    board_no, board_writer, board_title, board_content, board_time, 
    board_head, board_read, board_like, board_reply
) values(board_seq.nextval, 'testuser1', 'Å×½ºÆ®6', 'Å×½ºÆ®6', sysdate, null, 0, 0, 0);
insert into board(
    board_no, board_writer, board_title, board_content, board_time, 
    board_head, board_read, board_like, board_reply
) values(board_seq.nextval, 'testuser1', 'Å×½ºÆ®7', 'Å×½ºÆ®7', sysdate, null, 0, 0, 0);
insert into board(
    board_no, board_writer, board_title, board_content, board_time, 
    board_head, board_read, board_like, board_reply
) values(board_seq.nextval, 'testuser1', 'Å×½ºÆ®8', 'Å×½ºÆ®8', sysdate, null, 0, 0, 0);
insert into board(
    board_no, board_writer, board_title, board_content, board_time, 
    board_head, board_read, board_like, board_reply
) values(board_seq.nextval, 'testuser1', 'Å×½ºÆ®9', 'Å×½ºÆ®9', sysdate, null, 0, 0, 0);
insert into board(
    board_no, board_writer, board_title, board_content, board_time, 
    board_head, board_read, board_like, board_reply
) values(board_seq.nextval, 'testuser1', 'Å×½ºÆ®10', 'Å×½ºÆ®10', sysdate, null, 0, 0, 0);

-- ÃÖ±Ù °øÁö»çÇ× 3°³ Á¶È¸
    SELECT*FROM BOARD WHERE BOARD_HEAD='°øÁö' ORDER BY BOARD_NO DESC;
 SELECT * FROM(
        SELECT ROWNUM RN, TMP.* FROM (
            SELECT*FROM BOARD WHERE BOARD_HEAD='°øÁö' ORDER BY BOARD_NO DESC
        )TMP    
    ) WHERE RN BETWEEN 1 AND 3;
    
-- °øÁö»çÇ×À» »ó´Ü¿¡ Á¶È¸ÇÏ°í ³ª¸ÓÁö¸¦ ÇÏ´Ü¿¡ À§Ä¡ÇÏµµ·Ï Á¶È¸
-- ¼­·Î ´Ù¸¥ µÎ °³ÀÇ Á¶È¸ ±¸¹®À» »ç¿ëÇÑ µÚ °á°ú¸¦ ÇÕÄ§(ÁýÇÕ¿¬»ê)
-- VIEW¸¦ ¸¸µé¾î¼­ ³ª´©±â
/* 
UNION ALL : ÇÕÁýÇÕ
UNION DISTINCT : ÇÕÁýÇÕ¿¡¼­ Áßº¹Á¦°Å
INTERSECT : ±³ÁýÇÕ
MINUS : Â÷ÁýÇÕ
*/

    CREATE VIEW BOARD_NOTICE AS
    SELECT*FROM BOARD WHERE BOARD_HEAD='°øÁö' ORDER BY BOARD_NO DESC;
    create view board_OTHER AS
    SELECT*FROM BOARD WHERE BOARD_HEAD IS NULL OR BOARD_HEAD !='°øÁö' ORDER BY BOARD_NO DESC;
    
    SELECT*FROM BOARD_NOTICE
    UNION ALL
    SELECT*FROM BOARD_OTHER;


-- ´äº¯Çü °Ô½ÃÆÇ Å×ÀÌºíÀ» ¾Æ¿¹ »õ·Î ¸¸µé°í ½Í´Ù¸é
drop table board;
drop sequence board_seq;
create table board(
board_no number primary key,
board_writer references member(member_id) on delete set null,
board_title varchar2(300) not null,
board_content varchar2(4000) not null,
board_time date default sysdate not null,
board_head char(6) check(board_head in ('Á¤º¸', 'À¯¸Ó', '°øÁö')),
board_read number default 0 not null check(board_read >= 0),
board_like number default 0 not null check(board_like >= 0),
board_reply number default 0 not null check(board_reply >= 0),
board_group number not null check(board_group > 0),
board_parent number check(board_parent > 0),
board_depth number default 0 not null check(board_depth >= 0)
);
create sequence board_seq start with 1001;


SELECT * FROM BOARD
CONNECT BY PRIOR BOARD_NO=BOARD_PARENT
START WITH BOARD_PARENT IS NULL
ORDER SIBLINGS BY BOARD_GROUP DESC, BOARD_NO ASC;

commit;

-- Ã·ºÎÆÄÀÏ Å×ÀÌºí

create table attachment (
attachment_no number primary key,
attachment_name varchar2(256) not null,
attachment_type varchar2(60) not null,
attachment_size number not null
);

create sequence attachment_seq;
drop table attachment;
drop sequence attachment_seq;

-- Æ÷ÄÏ¸ó ÀÌ¹ÌÁö ¿¬°á Å×ÀÌºí
create table pocketmon_image (
pocketmon_no not null references pocketmon(no) on delete cascade,
attachment_no not null references attachment(attachment_no) on delete cascade
);

select*from pocketmon;
select*from attachment;
select*from pocketmon_image;
drop table attachment;
drop table pocketmon_image;

create table member_profile(
member_id not null references member(member_id) on delete cascade,
attachment_no not null references attachment(attachment_no) on delete cascade,
primary key(member_id, attachment_no)
);

select*from member;
select*from attachment;
select*from member_profile;

drop table attachment;

